{% extends "base.html" %}
{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}

{% block headtitle %}{% trans "Tutorials" %}{% endblock %}

{% block head %}{% endblock %}

{% block body %}
<div data-import-html>
  <header class="clearfix pattern-bg-lighter">
    <hgroup>
      <h1>HTML5 Rocks</h1>
      <h2>{% trans "Updates" %}</h2>
    </hgroup>
    <section class="filter">
      <div class="one_quarter">
        <h3>Format:</h3>
        <ul id="updates_format_filter">
          <li><label><input type="checkbox"> Tutorial</label></li>
          <li><label><input type="checkbox"> Article</label></li>
          <li><label><input type="checkbox"> Case Study</label></li>
          <li><label><input type="checkbox"> Announcement</label></li>
          <li><label><input type="checkbox"> Presentation</label></li>
          <li><label><input type="checkbox"> Video</label></li>
          <li><label><input type="checkbox"> Demo</label></li>
          <li><label><input type="checkbox"> Sample</label></li>
        </ul>
      </div>
      <div class="one_quarter">
        <h3>Audience:</h3>
        <ul>
          <li><label><input type="checkbox"> General</label></li>
          <li><label><input type="checkbox"> Mobile</label></li>
          <li><label><input type="checkbox"> Gaming</label></li>
          <li><label><input type="checkbox"> Business</label></li>
        </ul>
      </div>
      <div class="one_half">
        <h3>Technology:</h3>
        <ul>
          <li><label><input type="checkbox"> Offline</label></li>
          <li><label><input type="checkbox"> Storage</label></li>
          <li><label><input type="checkbox"> Connectivity</label></li>
          <li><label><input type="checkbox"> File Access</label></li>
          <li><label><input type="checkbox"> Semantics</label></li>
          <li><label><input type="checkbox"> Audio/Video</label></li>
          <li><label><input type="checkbox"> 3D/Graphics</label></li>
          <li><label><input type="checkbox"> Presentation</label></li>
          <li><label><input type="checkbox"> Performance</label></li>
          <li><label><input type="checkbox"> Nuts &amp; Bolts</label></li>
        </ul>
      </div>

      <div class="tag_filter">
        <label>
          Tags:
          <input type="text" placeholder="Comma separated list of tags: workers,filesystem,file,..." onchange="filterTag(this.value);">
        </label>
      </div>
    </section>

    <span class="share">
      <ul>
        <li class="googleplus"><div class="g-plusone" data-size="medium" data-count="true" data-href="{{disqus_url}}"></div></li>
        <li class="facebook"><iframe src="http://www.facebook.com/plugins/like.php?href={{disqus_url}}&amp;layout=button_count&amp;show_faces=false&amp;width=80&amp;action=like&amp;font=arial&amp;colorscheme=light&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:100px; height:21px;" allowTransparency="true"></iframe></li>
        <li class="twitter"><a href="http://twitter.com/share" class="twitter-share-button" data-url="{{disqus_url}}" data-via="ChromiumDev" data-lang="{{LANGUAGE_CODE}}" data-related="ChromiumDev:News and announcements for developers from the Google Chrome team and makers of HTML5 Rocks.">{% trans "Tweet" %}</a></li>
      </ul>
    </span>
  </header>

  <section class="hidden pattern-bg-lighter">
    <div id="filter" style="text-align: center;">
      {% trans "Filtering by tag" %}: <span id="filter_tag"></span>.
      <a href="javascript:clearFilter();" target="_blank">{% trans "[Clear filter]" %}</a>
    </div>
  </section>

  <section class="pattern-bg-lighter">
    <div id="index">
      <h2>Recent Updates 
      <a href="http://feeds.feedburner.com/html5rocks" style="vertical-align:text-top;" target="_blank">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAJpSURBVDjLfVNJT1NRGL0/wY0/wonaEesOAxoTF4bEpY1GFGGBqEUhggjYaCVIcIKC1TiHiCEBiXEhVdm4EDaaKI2WofTRlqbYR8sbOhzfd5v3tEK8i5d3F+fcM3wf+3x065bZc9t6F5rNCLeYsXTJgkibBUK7FcsdVkS7bIh57Ihfs2PFa0fihgOx6w4QhrCMfmKXnYi4y7DcbEK8zYxEhwVJjxW/vDaIPXak+xxYv1MOqX8PlEEn1PtOKP4KTsLoZQLH  vQeRfjeAzPsBiE9O/Rec9e+F7HMiqiljJJteXvXX4O9TkEUon4awPlS5KThzq5xbY+SZZCf7DkGa8kH9Mo58SvjDpKwh+/biBnCq245opw2MAtvMszxah0IiaPDkPl4tASc9Nh40ow+B089ruexceBrqVC/kB5Vcdj44YZDIr5sM8Eq71larBYyqopczw6dLMuDSR11cdm52wshltaeCg6MtVLtGQD3rsqVHh6FOdqEgCgaJOuLisvVcMgEfBwtuExYvmMEoyQ1VPd5vSC9oQPH2PqRHzhfvksjB4YYyLLh3g9GE6eD83AcUhBkemPKwylCSHrvCZROYTtR7BPP1uzB3ViOg8SSwOl5v2M9HprlsOXCz6ORbgMuWvk7ye/KlF6GTOxE6YwKj2SbZ2eFq7pmOOvOCp732tJbfs8J3Ljv1pr9IMHYXP47vwM8GjYAWQx8S5Vk1pFd1JVUlB2uQuHeCe15qPQCh+xjmm6oQdG1HqFGzQAtBi/HvkOhV6YGRZ5JNLxN4sbG4kUxfZ1oMaoTGk4aLhoR6pqoobQqMPJNsellf598J2Or0Mh3FtwAAAABJRU5ErkJggg==" width="16" height="16" />
      </a>
      </h2>

      {% for tut in tutorials %}
      <article class="tutorial_listing">
        <h3 id="{{tut.title|slugify}}" data-pubdate="{{tut.publication_date.year}}-{{tut.publication_date.month}}-{{tut.publication_date.day}}">
          <a href="{{tut.url}}">{{tut.title}}</a>
        </h3>
        <div>
          <span class="date">{{tut.publication_date}}</span>
          <span class="author" data-author_id="{{ tut.author.key.name }}">By
            <a href="/profiles/#!/{{ tut.author.key.name }}">
              <img class="author_image" src="/static/images/profiles/{{ tut.author.key.name }}.png" alt="{{ tut.author.given_name }} {{ tut.author.family_name }}" title="{{ tut.author.given_name }} {{ tut.author.family_name }}">
              {{ tut.author.given_name }} {{ tut.author.family_name }}
            </a>
            {% if tut.second_author %}
            <a href="/profiles/#!/{{ tut.second_author.key.name }}">
              <img class="author_image" src="/static/images/profiles/{{ tut.second_author.key.name }}.png" alt="{{ tut.second_author.given_name }} {{ tut.second_author.family_name }}" title="{{ tut.second_author.given_name }} {{ tut.second_author.family_name }}">
              {{ tut.second_author.given_name }} {{ tut.second_author.family_name }}
            </a>
            {% endif %}
          </span>
          {% if tut.browser_support %}
          <span class="browsers">
            <span class="browser opera {% if 'opera' in tut.browser_support %}supported{% endif %}"><span class="browser_name">Opera</span><span class="support">unsupported</span></span>
            <span class="browser ie {% if 'ie' in tut.browser_support %}supported{% endif %}"><span class="browser_name">Internet Explorer</span><span class="support">unsupported</span></span>
            <span class="browser safari {% if 'safari' in tut.browser_support %}supported{% endif %}"><span class="browser_name">Safari</span><span class="support">unsupported</span></span>
            <span class="browser ff {% if 'ff' in tut.browser_support %}supported{% endif %}"><span class="browser_name">Firefox</span><span class="support">unsupported</span></span>
            <span class="browser chrome {% if 'chrome' in tut.browser_support %}supported{% endif %}"><span class="browser_name">Chrome</span><span class="support">supported</span></span>
          </span>
          {% endif %}

          {% for tag in tut.tags %}
            <span class="tag {% if 'type:' in tag %}hidden{% endif %}">{{tag}}</span>
          {% endfor %}

          <div class="classes">
            {% for tag in tut.classes %}
              <span class="class {{tag}}"><span class="class_name">{{tag}}</span></span>
            {% endfor %}
          </div>
        </div>
        <div class="summary">
          {% if tut.description %}{{tut.description|safe}}{% endif %}
        </div>
      </article>
      {% endfor %}

    </div>
  </section>
</div>

<script>
$(document).ready(function() {
  $('.tag').click(filterTag);

  $('#updates_format_filter').click(function(e) {
    $(this).find('input[type="checkbox"]').attr('checked', false);

    var checkbox = e.target;
    checkbox.checked = true;
    var tag = checkbox.parentElement.textContent;

    // 'Case Study' -> 'casestudy'.
    var type = $.trim(tag).toLowerCase().replace(' ', '');

    if (checkbox.checked) {
      filterTag('type:' + type);
    } else {
      clearFilter();
    }
  });

  if (document.location.hash) {
    // Hide all samples as soon as DOM is loaded to prevent flicker effect.
    var samples = $('.tutorial_listing');
    samples.addClass('hidden');
    filterTag(document.location.hash.substring(1));
  }
});

function clearFilter() {
  $('.tutorial_listing.hidden').removeClass('hidden');
  $('.tag_filter input[type="text"]').val('');
  $('#updates_format_filter input[type="checkbox"]').attr('checked', false);
  $('#filter').parent().addClass('hidden');
  if (!!window.history) {
    var lang = document.documentElement.lang || 'en';
    history.replaceState({}, document.title, '/' + lang + '/tutorials');
  } else {
    document.location.hash = '';
  }
};

// TODO: this method is being called twice for some reason. Because of onhashchange?
function filterTag(opt_tag) {
  var e = window.event;

  // Don't perform another filter if we're initiated from a hashchange.
  if (!e || e.type == 'hashchange') {
    return;
  }

  var tag = typeof opt_tag == 'string' ? opt_tag : $(this).text();
  document.location.hash = tag;

  var samples = $('.tutorial_listing');

  if (tag) {
    var types = [];
    $('#updates_format_filter input[type="checkbox"]:checked').each(function(i, checkbox) {
      var type = checkbox.parentElement.textContent;
      // 'Case Study' -> 'casestudy'.
      types.push('type:' + $.trim(type).toLowerCase().replace(' ', ''));
    });

    samples.addClass('hidden');
    $.each(tag.split(','), function(i, eachtag) {
      if (types.length) {
        types.forEach(function(type, i) {
          samples.find('span.tag:contains("' + type + '")')
                 .closest('.tutorial_listing')
                 .find('span.tag:contains("' + eachtag + '")')
                 .closest('.tutorial_listing').removeClass('hidden');
        });
      } else {
        samples.find('span.tag:contains("' + eachtag + '")')
               .closest('.tutorial_listing').removeClass('hidden');
      }
    });
    $('#filter_tag').text(tag);
    $('#filter').parent().removeClass('hidden');
    //window.scrollTo(0, 0);
  } else {
    clearFilter();
  }
};

// Adds back button support.
window.addEventListener('hashchange', function(e) {
  filterTag(document.location.hash.substring(1));
  if (window._gaq) {
    _gaq.push(['_trackPageview', document.location.href]);
  }
}, false);
</script>
{% endblock %}
