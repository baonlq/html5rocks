{% extends "base.html" %}
{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}

{% block headtitle %}{% trans "A resource for open web HTML5 developers" %}{% endblock %}

{% block head %}
  <!--<link rel="stylesheet" media="only screen and (max-width: 640px)" href="/static/css/index_page_mobile{% if prod %}.min{% endif %}.css" />-->

  <script>
  $(document).ready(function() {
    // Scroll the updates into view, changing the width and margins of the container to simulate movement from the edges of the window.
    $('#updates_badge').click(function() {
      $('#start').css({'width': '100%'});//, 'margin-top': '-1.5em'});
      $('#logo').animate({
        left: -2500
      }, 300);
      $('#updates').animate({
        left: 0
      }, 300, function() {
        $('#start').animate({
          width: '1000px',
          margin: '0 auto'
        }, 300);
      });
    });

    function hideScrollToTechnologyArrow() {
      $('#scroll-technology').css('position', 'relative').animate({
        top: -200,
        opacity: 0,
        height: 0
      }, 600);
    }

    $('#scroll-technology').click( function() {
      $.scrollTo('#intro', 600, {margin: true, offset: -25});
      hideScrollToTechnologyArrow();
      $('body').addClass('scrolled');
    });

    $('#scroll-authors').click( function() {
      $.scrollTo('#authors', 600, {margin: true, offset: -25});
    });

    var top = $('html, body').offset().top;

    $(window).scroll(function(event) {
      // Get the position of the vertical scroll.
      var y = $(this).scrollTop();

      if (y > top) {
        document.querySelector('.watermark').classList.add('fadeIn');

        if (!$('body').hasClass('scrolled')) {
          hideScrollToTechnologyArrow();
          $('body').addClass('scrolled');
        }
      } else {
        document.querySelector('.watermark').classList.remove('fadeIn');

        $('body').removeClass('scrolled');

        // Reappear the 'Scroll to Technology' arrow.
        $('#scroll-technology').css('position', 'relative').animate({
          top: 0,
          opacity: 1,
          height: 100
        }, 600);
      }
    });
  });
  </script>
{% endblock %}

{% block body %}

<header id="start">
  <div id="logo">
    <img src="/static/images/logo.png" width="459" height="364">
    <img id="updates_badge" src="/static/images/updates_badge.png" width="101" height="102">
  </div>
  <section id="updates" class="feed pattern-bg">
    <img src="/static/images/updates_title.png" id="updates_title">
    <h2>{% trans "Latest Updates" %}
      <a href="http://feeds.feedburner.com/html5rocks" style="vertical-align:text-top;" target="_blank">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAJpSURBVDjLfVNJT1NRGL0/wY0/wonaEesOAxoTF4bEpY1GFGGBqEUhggjYaCVIcIKC1TiHiCEBiXEhVdm4EDaaKI2WofTRlqbYR8sbOhzfd5v3tEK8i5d3F+fcM3wf+3x065bZc9t6F5rNCLeYsXTJgkibBUK7FcsdVkS7bIh57Ihfs2PFa0fihgOx6w4QhrCMfmKXnYi4y7DcbEK8zYxEhwVJjxW/vDaIPXak+xxYv1MOqX8PlEEn1PtOKP4KTsLoZQLHvQeRfjeAzPsBiE9O/Rec9e+F7HMiqiljJJteXvXX4O9TkEUon4awPlS5KThzq5xbY+SZZCf7DkGa8kH9Mo58SvjDpKwh+/biBnCq245opw2MAtvMszxah0IiaPDkPl4tASc9Nh40ow+B089ruexceBrqVC/kB5Vcdj44YZDIr5sM8Eq71larBYyqopczw6dLMuDSR11cdm52wshltaeCg6MtVLtGQD3rsqVHh6FOdqEgCgaJOuLisvVcMgEfBwtuExYvmMEoyQ1VPd5vSC9oQPH2PqRHzhfvksjB4YYyLLh3g9GE6eD83AcUhBkemPKwylCSHrvCZROYTtR7BPP1uzB3ViOg8SSwOl5v2M9HprlsOXCz6ORbgMuWvk7ye/KlF6GTOxE6YwKj2SbZ2eFq7pmOOvOCp732tJbfs8J3Ljv1pr9IMHYXP47vwM8GjYAWQx8S5Vk1pFd1JVUlB2uQuHeCe15qPQCh+xjmm6oQdG1HqFGzQAtBi/HvkOhV6YGRZ5JNLxN4sbG4kUxfZ1oMaoTGk4aLhoR6pqoobQqMPJNsellf598J2Or0Mh3FtwAAAABJRU5ErkJggg==" width="16" height="16" alt="{% trans "RSS" %}" />
      </a>
    </h2>
    <ul id="latest_articles_feed"><li><i>{% trans "loading feed..." %}</i></li></ul>
    <p><a href="/{{LANGUAGE_CODE}}/tutorials/">{% trans "See more &rarr;" %}</a></p>
  </section>
</header>

<article id="intro" class="clearfix sectioned">
  <header class="two_columns clearfix pattern-bg">
    <hgroup>
      <h1>Welcome to HTML5ROCKS</h1>
      <h2>What kind of HTML dev do you think you are?</h2>
    </hgroup>
    <p>Pid cras vel odio lundium natoque integer urna adipiscing tortor scelerisque vut! Mauris montes pellentesque in pulvinar eu, natoque natoque mid phasellus, lectus ut, aliquet! Duis, dis urna rhoncus augue ac mattis dapibus est. Sit cras, nec mattis, elit, ut cras turpis, ridiculus quis elementum et? Turpis et, cras mauris!</p>
  </header>

  <div class="clearfix thirds">
    <section class="one_third link_target pattern-bg">
      <a href="/{{LANGUAGE_CODE}}/mobile">
        <h2>Mobile</h2>
        <p>Duis, dis urna rhoncus augue ac mattis dapibus est. Sit cras, nec mattis, elit, ut cras turpis, ridiculus quis elementum et? Turpis et, cras mauris! Placerat mid integer nunc.</p>
      </a>
    </section>

    <section class="one_third link_target pattern-bg">
      <a href="/{{LANGUAGE_CODE}}/gaming">
        <h2>Gaming</h2>
        <p>Pid cras vel odio lundium natoque integer urna adipiscing tortor scelerisque vut! Mauris montes pellentesque in pulvinar eu, natoque natoque mid phasellus, lectus ut, aliquet!</p>
      </a>
    </section>

    <section class="one_third link_target pattern-bg">
      <a href="/{{LANGUAGE_CODE}}/business">
        <h2>Business</h2>
        <p>Sit cras, nec mattis, elit, ut cras turpis, ridiculus quis elementum et? Turpis et, cras mauris! Placerat mid integer nunc parturient nec, aliquam, lacus nec lundium!</p>
      </a>
    </section>
  </div>
</article>

<a id="scroll-technology" class="nav arrow_down">Or get straight to the tech!</a>

<article id="technology" class="clearfix sectioned">
  <section id="classes" class="pattern-bg">
    <header class="two_columns">
      <hgroup>
        <h1>HTML5 Features</h1>
      </hgroup>
      <p>Pid cras vel odio lundium natoque integer urna adipiscing tortor scelerisque vut! Mauris montes pellentesque in pulvinar eu, natoque natoque mid phasellus, lectus ut, aliquet! Duis, dis urna rhoncus.</p>
    </header>

    <ul>
      <li class="offline"><a href="/{{LANGUAGE_CODE}}/features/offline"><h3>{% trans "Offline" %}</h3></a></li>
      <li class="storage"><a href="/{{LANGUAGE_CODE}}/features/storage"><h3>{% trans "Storage" %}</h3></a></li>
      <li class="connectivity"><a href="/{{LANGUAGE_CODE}}/features/connectivity"><h3>{% trans "Connectivity" %}</h3></a></li>
      <li class="file_access"><a href="/{{LANGUAGE_CODE}}/features/file_access"><h3>{% trans "File Access" %}</h3></a></li>
      <li class="semantics"><a href="/{{LANGUAGE_CODE}}/features/semantics"><h3>{% trans "Semantics" %}</h3></a></li>
      <li class="multimedia"><a href="/{{LANGUAGE_CODE}}/features/multimedia"><h3>{% trans "Audio/Video" %}</h3></a></li>
      <li class="graphics"><a href="/{{LANGUAGE_CODE}}/features/graphics"><h3>{% trans "3D/Graphics" %}</h3></a></li>
      <li class="presentation"><a href="/{{LANGUAGE_CODE}}/features/presentation"><h3>{% trans "Presentation" %}</h3></a></li>
      <li class="performance"><a href="/{{LANGUAGE_CODE}}/features/performance"><h3>{% trans "Performance" %}</h3></a></li>
      <li class="nuts_and_bolts"><a href="/{{LANGUAGE_CODE}}/features/nuts_and_bolts"><h3>{% trans "Nuts &amp; Bolts" %}</h3></a></li>
    </ul>
  </section>

  <div class="clearfix thirds">
    <section class="one_third link_target pattern-bg">
      <a href="/{{LANGUAGE_CODE}}/why">
        <h2>Why HTML5?</h2>
        <p><strong>Pid cras vel odio lundium</strong><br>Natoque integer urna adipiscing tortor scelerisque vut! ....</p>
      </a>
    </section>

    <section class="one_third link_target pattern-bg">
      <a href="/{{LANGUAGE_CODE}}/tutorials/">
        <h2>Updates</h2>
        <p><strong>Pid cras vel odio lundium</strong><br>Natoque integer urna adipiscing tortor scelerisque vut! ....</p>
      </a>
    </section>

    <section class="one_third link_target pattern-bg">
      <a href="/{{LANGUAGE_CODE}}/resources">
        <h2>Resources</h2>
        <p><strong>Pid cras vel odio lundium</strong><br>Natoque integer urna adipiscing tortor scelerisque vut! ....</p>
      </a>
    </section>
  </div>
</article>

<a id="scroll-authors" class="nav arrow_down">HTML5 Contributors</a>

<article id="authors" class="clearfix sectioned">
  <header class="two_columns clearfix pattern-bg">
    <hgroup>
      <h1>HTML5 Gurus Rock</h1>
      <h2>New Hotness Every Day</h2>
    </hgroup>
    <p>Pid cras vel odio lundium natoque integer urna adipiscing tortor scelerisque vut! Mauris montes pellentesque in pulvinar eu, natoque natoque mid phasellus, lectus ut, aliquet! Duis, dis urna rhoncus.</p>
  </header>

  <div class="authors_wrapper">
  {% for profile in sorted_profiles %}
    <article class="profile pattern-bg" id="{{profile.id}}" itemscope itemtype="http://microformats.org/profile/hcard">
      <a href="/{{LANGUAGE_CODE}}/profiles#{{profile.id}}">
      <section>
        <img itemprop="photo" alt="{{profile.given_name}} {{profile.family_name}}" title="{{profile.given_name}} {{profile.family_name}}" src="/static/images/profiles/{{profile.id}}.png">
        <hgroup>
          <h2>
            <div itemprop="fn">
              <div itemprop="n" itemscope>
                <span itemprop="given-name">{{profile.given_name}}</span>
                <span itemprop="family-name">{{profile.family_name}}</span>
              </div>
            </div>
          </h2>
          <h3 itemprop="org" itemscope>
            {% if profile.unit %}<div itemprop="organization-unit">{{profile.unit}}</div>{% endif %}
            {% if profile.org %}<div itemprop="organization-name">{{profile.org}}</div>{% endif %}
          </h3>
        </hgroup>
      </section>
      </a>
    </article>
  {% endfor %}
  </div>
</article>

<script>
function processPipeFeed(result) {
  var container = document.getElementById('latest_articles_feed');

  if (!container || !result.value.items) {
    return;
  }

  if (container.textContent == 'loading feed...') {
    container.textContent = '';
  }

  var html = [];
  for (var i = 0, entry; entry = result.value.items[i]; ++i) {
    var date = new Date(entry.pubDate.split('T')[0].replace(/-/g, '/'));
    var formattedDateStr = date.getUTCMonth() + 1 + '/' + date.getUTCDate();

    var author = '';
    if (entry.author) {
      author = entry.author.name;
    }

    var classes = '<span class="classes">';
    if (entry.category && entry.category.length) {
      entry.category.forEach(function(cat) {
        classes += '<span class="class ' + cat.term + '"><span class="class_name">' + cat.term + '</span></span>';
        //TODO: use each cat.term
        //TODO: do categories correspond to classes? No -- categories are formats: Tutorial, Article, Case Study, Announcements, Presentation, Video
        //                                                 classes are technologies: Offline, Storage, Connectivity, File, Access, Semantics, Audio/Video, 3D/Graphics, Presentation, Performance, Nuts & Bolts
        //                                                 audiences/personas: General, Mobile, Gaming, Business
      });
    }
    classes += '</span>';

    var type = '';
    if (entry.id.match('www.html5rocks.com') || entry.id.match('htmlfiverocks')) {
      type = 'tutorial';
    } else if (entry.id.match('updates.html5rocks.com')) {
      type = 'update';
    }

    html.push('<li><span class="byline"><span class="date">', formattedDateStr, '</span> ',
              '<span class="author">', author ? '<img src="/static/images/profiles/' + author + '.png">' : '', '</span></span>',
              '<span class="details"><span class="title">', entry.title.link(entry.link), '</span>',
              classes,
              '<span data-type="', type, '" class="type">', type, '</span></span></li>');
  }
  container.innerHTML += html.join('');
}

{% if not is_mobile %}
  (function(){
    var kkeys = [], konami = "38,38,40,40,37,39,37,39,66,65";
    document.addEventListener('keydown', function hdl(e) {
      kkeys.push( e.keyCode );
      if ( kkeys.toString().indexOf( konami ) >= 0 ){
        document.removeEventListener('keydown', hdl, false);
          var ref    = document.getElementsByTagName('script')[0],
              script = document.createElement('script');
          // thx a bunch erkie!  github.com/erkie/erkie.github.com
          script.src = '/static/js/boom/asteroids.min.js';
          ref.parentNode.insertBefore(script, ref);
      }
    }, false);
  })();
{% endif %}
</script>
<script src="http://pipes.yahoo.com/pipes/pipe.run?_id=119e0da707bc08778cbf04df91bc4418&_render=json&_callback=processPipeFeed"></script>
{% endblock %}